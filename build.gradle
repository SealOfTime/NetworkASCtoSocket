/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn how to create Gradle builds at https://guides.gradle.org/creating-new-gradle-builds
 */
buildscript {
        repositories {
            jcenter()
        }
        dependencies {
            classpath 'com.github.jengelman.gradle.plugins:shadow:6.0.0'
        }
}
apply plugin: 'com.github.johnrengelman.shadow'

allprojects {
    apply plugin: 'com.github.johnrengelman.shadow'
    apply plugin: 'java'
    sourceSets {
        main {
            java {
                srcDirs = ["src/main/java"]
            }
            resources {
                srcDirs = ["src/main/resources"]
            }
        }
    }

    task copyRuntimeLibs(type: Copy) {
        into "build/libs"
        from configurations.runtime
    }

    tasks.named("build").get().finalizedBy(copyRuntimeLibs)
}

ext.rootBuild = file("build")
project(':server'){
    dependencies {
        shadow project(path: ":shared", configuration: "shadow")
    }
    shadowJar{
    }
//    tasks.named('shadowJar').get().outputs.dir("build/server")
}

project(':client'){
    dependencies {
        shadow project(path: ":shared", configuration: "shadow")
    }
    tasks.named('shadowJar').get().outputs.dir("build/client")
}

task compileServer(type: Copy){
    destinationDir = file("build/server")
    //archiveName = "server.jar"
    from(project('server').tasks.named('shadowJar').get().getOutputs())
}
task compileClient(type: Copy){
    destinationDir = file("build/client")
    from(project('client').tasks.named('shadowJar').get().getOutputs())
}